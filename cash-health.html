<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Health Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #e0f7fa 0%, #f3e5f5 100%); padding: 20px; transition: all 0.3s ease; }
        body.dark-mode { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { font-size: 32px; font-weight: 600; margin-bottom: 20px; color: #1d1d1f; text-align: center; }
        body.dark-mode h1 { color: #e8e8e8; }
        .theme-toggle { text-align: center; margin-bottom: 20px; }
        .theme-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 14px; font-weight: 500; cursor: pointer; transition: transform 0.2s; }
        .theme-btn:hover { transform: scale(1.05); }
        .status-banner { padding: 30px; border-radius: 20px; margin-bottom: 30px; text-align: center; font-size: 24px; font-weight: 600; color: #1d1d1f; transition: all 0.3s ease; box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .status-green { background: linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%); }
        .status-yellow { background: linear-gradient(135deg, #ffd3b6 0%, #ffaaa5 100%); }
        .status-red { background: linear-gradient(135deg, #ffaaa5 0%, #ff8b94 100%); }
        body.dark-mode .status-banner { color: #1d1d1f; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        @media (max-width: 1200px) { .grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { .grid { grid-template-columns: 1fr; } }
        .card { background: linear-gradient(135deg, #fff5f7 0%, #ffe5ec 100%); border-radius: 20px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; }
        .card:nth-child(2) { background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%); }
        .card:nth-child(3) { background: linear-gradient(135deg, #fff9c4 0%, #ffecb3 100%); }
        .card:nth-child(4) { background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%); }
        body.dark-mode .card { background: linear-gradient(135deg, #2d2d44 0%, #3a3a52 100%); box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        body.dark-mode .card:nth-child(2) { background: linear-gradient(135deg, #2d3e4d 0%, #3a4f5e 100%); }
        body.dark-mode .card:nth-child(3) { background: linear-gradient(135deg, #4d3e2d 0%, #5e4f3a 100%); }
        body.dark-mode .card:nth-child(4) { background: linear-gradient(135deg, #3e2d4d 0%, #4f3a5e 100%); }
        .card h2 { font-size: 20px; font-weight: 600; margin-bottom: 20px; color: #1d1d1f; }
        body.dark-mode .card h2 { color: #e8e8e8; }
        .card h3 { font-size: 16px; font-weight: 600; margin-top: 20px; margin-bottom: 10px; color: #6e6e73; border-bottom: 2px solid rgba(0,0,0,0.1); padding-bottom: 5px; }
        body.dark-mode .card h3 { color: #b8b8b8; border-bottom-color: rgba(255,255,255,0.2); }
        .form-group { margin-bottom: 12px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { display: block; font-size: 13px; font-weight: 500; margin-bottom: 5px; color: #6e6e73; }
        body.dark-mode label { color: #b8b8b8; }
        input, select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 15px; transition: all 0.2s; background: rgba(255,255,255,0.8); }
        body.dark-mode input, body.dark-mode select { background: rgba(255,255,255,0.1); border-color: #4a4a5e; color: #e8e8e8; }
        input:focus, select:focus { outline: none; border-color: #667eea; background: white; }
        body.dark-mode input:focus, body.dark-mode select:focus { background: rgba(255,255,255,0.15); }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-size: 16px; font-weight: 500; cursor: pointer; transition: all 0.2s; width: 100%; box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3); }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4); }
        .button-secondary { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); margin-top: 10px; }
        .button-secondary:hover { box-shadow: 0 6px 15px rgba(240, 147, 251, 0.4); }
        .metric-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        body.dark-mode .metric-row { border-bottom-color: rgba(255,255,255,0.1); }
        .metric-row:last-child { border-bottom: none; }
        .metric-label { font-weight: 500; color: #1d1d1f; font-size: 14px; }
        body.dark-mode .metric-label { color: #e8e8e8; }
        .metric-value { font-weight: 600; font-size: 14px; }
        .metric-green { color: #52b788; }
        .metric-yellow { color: #f4a261; }
        .metric-red { color: #e76f51; }
        body.dark-mode .metric-green { color: #a8e6cf; }
        body.dark-mode .metric-yellow { color: #ffd3b6; }
        body.dark-mode .metric-red { color: #ffaaa5; }
        .big-number { font-size: 48px; font-weight: 700; text-align: center; margin: 20px 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        body.dark-mode .big-number { background: linear-gradient(135deg, #a8e6cf 0%, #ffd3b6 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { text-align: center; color: #6e6e73; font-size: 14px; }
        body.dark-mode .subtitle { color: #b8b8b8; }
        .settings-toggle { text-align: center; margin-bottom: 20px; }
        .settings-content { display: none; }
        .settings-content.active { display: block; }
        .form-scroll { max-height: 600px; overflow-y: auto; padding-right: 10px; }
        .form-scroll::-webkit-scrollbar { width: 8px; }
        .form-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
        .form-scroll::-webkit-scrollbar-thumb { background: rgba(102, 126, 234, 0.5); border-radius: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Cash Health Tracker</h1>
        <div class="theme-toggle">
            <button onclick="toggleTheme()" class="theme-btn" id="themeBtn">üåô Dark Mode</button>
        </div>
        <div class="settings-toggle">
            <button onclick="toggleSettings()" class="button-secondary" style="width: auto; padding: 8px 16px;">‚öôÔ∏è Weekly Target Settings</button>
        </div>
        <div id="settingsContent" class="settings-content">
            <div class="card" style="margin-bottom: 30px;">
                <h2>‚öôÔ∏è Weekly Target Configuration</h2>
                <div class="form-group">
                    <label>Weekly Sales Target ($)</label>
                    <input type="number" id="weeklyTarget" step="0.01" value="204213.29">
                </div>
                <button onclick="saveTarget()">üíæ Save Target</button>
            </div>
        </div>
        <div id="statusBanner" class="status-banner status-green">üü¢ CASH HEALTHY</div>
        <div class="grid">
            <div class="card">
                <h2>üìù Daily Entry</h2>
                <div class="form-scroll">
                    <form id="dailyForm">
                        <div class="form-group"><label>Date</label><input type="date" id="entryDate" required></div>
                        <div class="form-group"><label>Daily Sales ($)</label><input type="number" id="dailySales" step="0.01" required></div>
                        <h3>Top-line Skims (% of Sales)</h3>
                        <div class="form-row">
                            <div class="form-group"><label>Taxes %</label><input type="number" id="taxesPercent" step="0.1" value="8.3"></div>
                            <div class="form-group"><label>Royalty %</label><input type="number" id="royaltyPercent" step="0.1" value="4.5"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Rent %</label><input type="number" id="rentPercent" step="0.1" value="8.5"></div>
                            <div class="form-group"><label>Advertising %</label><input type="number" id="adPercent" step="0.1" value="4.0"></div>
                        </div>
                        <h3>Operational Expenses (% of Sales)</h3>
                        <div class="form-row">
                            <div class="form-group"><label>COGS %</label><input type="number" id="cogsPercent" step="0.1" value="36.7"></div>
                            <div class="form-group"><label>Labor %</label><input type="number" id="laborPercent" step="0.1" value="19.0"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>R&M %</label><input type="number" id="rmPercent" step="0.1" value="0.7"></div>
                            <div class="form-group"><label>Utilities %</label><input type="number" id="utilitiesPercent" step="0.1" value="2.2"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>Merchant Fees %</label><input type="number" id="merchantPercent" step="0.1" value="0.6"></div>
                            <div class="form-group"><label>Ops Supplies %</label><input type="number" id="suppliesPercent" step="0.1" value="0.0"></div>
                        </div>
                        <div class="form-group"><label>Insurance/Licenses/IT %</label><input type="number" id="insurancePercent" step="0.1" value="0.5"></div>
                        <h3>Cash Position</h3>
                        <div class="form-group"><label>Current Cash Balance ($)</label><input type="number" id="cashBalance" step="0.01" required></div>
                        <button type="submit">üíæ Save Entry</button>
                    </form>
                </div>
            </div>
            <div class="card">
                <h2>üìä This Week's Performance</h2>
                <div class="metric-row"><span class="metric-label">Weekly Sales</span><span class="metric-value" id="weeklySales">$0</span></div>
                <div class="metric-row"><span class="metric-label">Target Sales</span><span class="metric-value" id="targetDisplay">$204,213</span></div>
                <div class="metric-row"><span class="metric-label">Sales Pace</span><span class="metric-value" id="salesPace">0%</span></div>
                <h3>Expense Breakdown</h3>
                <div class="metric-row"><span class="metric-label">Total Skims %</span><span class="metric-value" id="totalSkims">0%</span></div>
                <div class="metric-row"><span class="metric-label">Total Ops %</span><span class="metric-value" id="totalOps">0%</span></div>
                <div class="metric-row"><span class="metric-label">EBITDA %</span><span class="metric-value" id="ebitdaPercent">0%</span></div>
                <h3>Key Metrics</h3>
                <div class="metric-row"><span class="metric-label">Avg COGS %</span><span class="metric-value" id="avgCOGS">0%</span></div>
                <div class="metric-row"><span class="metric-label">Avg Labor %</span><span class="metric-value" id="avgLabor">0%</span></div>
            </div>
            <div class="card">
                <h2>üè¶ Cash Position</h2>
                <div class="big-number" id="cashRunway">-- days</div>
                <div class="subtitle">Cash Runway</div>
                <div style="margin-top: 20px;">
                    <div class="metric-row"><span class="metric-label">Cash on Hand</span><span class="metric-value" id="cashOnHand">$0</span></div>
                    <div class="metric-row"><span class="metric-label">Daily Burn Rate</span><span class="metric-value" id="burnRate">$0</span></div>
                </div>
                <h3>üö¶ KPI Status</h3>
                <div class="metric-row"><span class="metric-label">Cash Runway</span><span class="metric-value metric-green" id="runwayStatus">--</span></div>
                <div class="metric-row"><span class="metric-label">Sales Pace</span><span class="metric-value metric-green" id="paceStatus">--</span></div>
                <div class="metric-row"><span class="metric-label">Labor %</span><span class="metric-value metric-green" id="laborStatus">--</span></div>
                <div class="metric-row"><span class="metric-label">COGS %</span><span class="metric-value metric-green" id="cogsStatus">--</span></div>
                <div class="metric-row"><span class="metric-label">EBITDA %</span><span class="metric-value metric-green" id="ebitdaStatus">--</span></div>
            </div>
        </div>
    </div>
    <script>
        const API_BASE = 'http://localhost:3000/api';
        const THRESHOLDS = { cashRunway: { green: 30, yellow: 15 }, salesPace: { green: 95, yellow: 85 }, labor: { green: 19, yellow: 21 }, cogs: { green: 37, yellow: 39 }, ebitda: { green: 15, yellow: 12 } };
        let currentSettings = {};
        async function fetchSettings() { try { const response = await fetch(`${API_BASE}/settings`); currentSettings = await response.json(); return currentSettings; } catch (error) { return { weekly_target: '204213.29', dark_mode: 'false' }; } }
        async function updateSetting(key, value) { try { await fetch(`${API_BASE}/settings/${key}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ value: String(value) }) }); } catch (error) { console.error('Error updating setting:', error); } }
        async function fetchEntries() { try { const response = await fetch(`${API_BASE}/entries`); return await response.json(); } catch (error) { return []; } }
        async function createEntry(entryData) { try { const response = await fetch(`${API_BASE}/entries`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(entryData) }); return await response.json(); } catch (error) { throw error; } }
        async function toggleTheme() { const isDark = document.body.classList.toggle('dark-mode'); document.getElementById('themeBtn').textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode'; await updateSetting('dark_mode', isDark); }
        function applyTheme(isDark) { if (isDark) { document.body.classList.add('dark-mode'); document.getElementById('themeBtn').textContent = '‚òÄÔ∏è Light Mode'; } else { document.body.classList.remove('dark-mode'); document.getElementById('themeBtn').textContent = 'üåô Dark Mode'; } }
        function toggleSettings() { document.getElementById('settingsContent').classList.toggle('active'); }
        async function saveTarget() { const target = parseFloat(document.getElementById('weeklyTarget').value); await updateSetting('weekly_target', target); await updateDashboard(); alert('‚úÖ Weekly target saved!'); toggleSettings(); }
        function getThisWeekEntries(entries) { const now = new Date(); const weekStart = new Date(now); weekStart.setDate(now.getDate() - now.getDay()); weekStart.setHours(0, 0, 0, 0); return entries.filter(entry => { const entryDate = new Date(entry.entry_date); return entryDate >= weekStart; }); }
        function calculateMetrics(entries, weeklyTarget) { if (entries.length === 0) return null; const weekEntries = getThisWeekEntries(entries); const weeklySales = weekEntries.reduce((sum, e) => sum + e.daily_sales, 0); const avgTaxes = weekEntries.reduce((sum, e) => sum + e.taxes_percent, 0) / weekEntries.length; const avgRoyalty = weekEntries.reduce((sum, e) => sum + e.royalty_percent, 0) / weekEntries.length; const avgRent = weekEntries.reduce((sum, e) => sum + e.rent_percent, 0) / weekEntries.length; const avgAd = weekEntries.reduce((sum, e) => sum + e.advertising_percent, 0) / weekEntries.length; const avgCOGS = weekEntries.reduce((sum, e) => sum + e.cogs_percent, 0) / weekEntries.length; const avgLabor = weekEntries.reduce((sum, e) => sum + e.labor_percent, 0) / weekEntries.length; const avgRM = weekEntries.reduce((sum, e) => sum + e.rm_percent, 0) / weekEntries.length; const avgUtilities = weekEntries.reduce((sum, e) => sum + e.utilities_percent, 0) / weekEntries.length; const avgMerchant = weekEntries.reduce((sum, e) => sum + e.merchant_percent, 0) / weekEntries.length; const avgSupplies = weekEntries.reduce((sum, e) => sum + e.supplies_percent, 0) / weekEntries.length; const avgInsurance = weekEntries.reduce((sum, e) => sum + e.insurance_percent, 0) / weekEntries.length; const totalSkims = avgTaxes + avgRoyalty + avgRent + avgAd; const totalOps = avgCOGS + avgLabor + avgRM + avgUtilities + avgMerchant + avgSupplies + avgInsurance; const ebitdaPercent = 100 - totalSkims - totalOps; const latestEntry = entries[entries.length - 1]; const cashBalance = latestEntry.cash_balance; const avgDailySales = weeklySales / Math.max(weekEntries.length, 1); const dailyTotalCost = avgDailySales * ((totalSkims + totalOps) / 100); const cashRunway = dailyTotalCost > 0 ? Math.floor(cashBalance / dailyTotalCost) : 999; return { weeklySales, salesPace: (weeklySales / weeklyTarget) * 100, totalSkims, totalOps, avgCOGS, avgLabor, ebitdaPercent, cashBalance, cashRunway, dailyBurn: dailyTotalCost }; }
        function getTrafficLight(value, thresholds, inverse = false) { if (inverse) { if (value <= thresholds.green) return 'green'; if (value <= thresholds.yellow) return 'yellow'; return 'red'; } else { if (value >= thresholds.green) return 'green'; if (value >= thresholds.yellow) return 'yellow'; return 'red'; } }
        async function updateDashboard() { const settings = await fetchSettings(); const weeklyTarget = parseFloat(settings.weekly_target || 204213.29); document.getElementById('targetDisplay').textContent = `$${weeklyTarget.toLocaleString('en-US', {maximumFractionDigits: 0})}`; document.getElementById('weeklyTarget').value = weeklyTarget; const entries = await fetchEntries(); const metrics = calculateMetrics(entries, weeklyTarget); if (!metrics) { document.getElementById('statusBanner').textContent = '‚ö™ NO DATA - Add your first entry'; document.getElementById('statusBanner').className = 'status-banner'; document.getElementById('statusBanner').style.background = '#e0e0e0'; return; } document.getElementById('weeklySales').textContent = `$${metrics.weeklySales.toLocaleString('en-US', {maximumFractionDigits: 0})}`; document.getElementById('salesPace').textContent = `${metrics.salesPace.toFixed(1)}%`; document.getElementById('totalSkims').textContent = `${metrics.totalSkims.toFixed(1)}%`; document.getElementById('totalOps').textContent = `${metrics.totalOps.toFixed(1)}%`; document.getElementById('avgCOGS').textContent = `${metrics.avgCOGS.toFixed(1)}%`; document.getElementById('avgLabor').textContent = `${metrics.avgLabor.toFixed(1)}%`; document.getElementById('ebitdaPercent').textContent = `${metrics.ebitdaPercent.toFixed(1)}%`; document.getElementById('cashRunway').textContent = `${metrics.cashRunway} days`; document.getElementById('cashOnHand').textContent = `$${metrics.cashBalance.toLocaleString('en-US', {maximumFractionDigits: 0})}`; document.getElementById('burnRate').textContent = `$${metrics.dailyBurn.toLocaleString('en-US', {maximumFractionDigits: 0})}`; const lights = { runway: getTrafficLight(metrics.cashRunway, THRESHOLDS.cashRunway), pace: getTrafficLight(metrics.salesPace, THRESHOLDS.salesPace), labor: getTrafficLight(metrics.avgLabor, THRESHOLDS.labor, true), cogs: getTrafficLight(metrics.avgCOGS, THRESHOLDS.cogs, true), ebitda: getTrafficLight(metrics.ebitdaPercent, THRESHOLDS.ebitda) }; document.getElementById('runwayStatus').textContent = lights.runway === 'green' ? 'üü¢ Good' : lights.runway === 'yellow' ? 'üü° Caution' : 'üî¥ Critical'; document.getElementById('runwayStatus').className = `metric-value metric-${lights.runway}`; document.getElementById('paceStatus').textContent = lights.pace === 'green' ? 'üü¢ On Track' : lights.pace === 'yellow' ? 'üü° Behind' : 'üî¥ Way Behind'; document.getElementById('paceStatus').className = `metric-value metric-${lights.pace}`; document.getElementById('laborStatus').textContent = lights.labor === 'green' ? 'üü¢ Good' : lights.labor === 'yellow' ? 'üü° High' : 'üî¥ Too High'; document.getElementById('laborStatus').className = `metric-value metric-${lights.labor}`; document.getElementById('cogsStatus').textContent = lights.cogs === 'green' ? 'üü¢ Good' : lights.cogs === 'yellow' ? 'üü° High' : 'üî¥ Too High'; document.getElementById('cogsStatus').className = `metric-value metric-${lights.cogs}`; document.getElementById('ebitdaStatus').textContent = lights.ebitda === 'green' ? 'üü¢ Strong' : lights.ebitda === 'yellow' ? 'üü° Weak' : 'üî¥ Poor'; document.getElementById('ebitdaStatus').className = `metric-value metric-${lights.ebitda}`; const redCount = Object.values(lights).filter(l => l === 'red').length; const yellowCount = Object.values(lights).filter(l => l === 'yellow').length; let overallStatus, overallClass, overallEmoji; if (redCount >= 2) { overallStatus = 'CASH DANGER'; overallClass = 'status-red'; overallEmoji = 'üî¥'; } else if (redCount === 1 || yellowCount >= 2) { overallStatus = 'CAUTION'; overallClass = 'status-yellow'; overallEmoji = 'üü°'; } else { overallStatus = 'CASH HEALTHY'; overallClass = 'status-green'; overallEmoji = 'üü¢'; } document.getElementById('statusBanner').textContent = `${overallEmoji} ${overallStatus}`; document.getElementById('statusBanner').className = `status-banner ${overallClass}`; }
        document.getElementById('dailyForm').addEventListener('submit', async function(e) { e.preventDefault(); const entryData = { entry_date: document.getElementById('entryDate').value, daily_sales: parseFloat(document.getElementById('dailySales').value), taxes_percent: parseFloat(document.getElementById('taxesPercent').value), royalty_percent: parseFloat(document.getElementById('royaltyPercent').value), rent_percent: parseFloat(document.getElementById('rentPercent').value), advertising_percent: parseFloat(document.getElementById('adPercent').value), cogs_percent: parseFloat(document.getElementById('cogsPercent').value), labor_percent: parseFloat(document.getElementById('laborPercent').value), rm_percent: parseFloat(document.getElementById('rmPercent').value), utilities_percent: parseFloat(document.getElementById('utilitiesPercent').value), merchant_percent: parseFloat(document.getElementById('merchantPercent').value), supplies_percent: parseFloat(document.getElementById('suppliesPercent').value), insurance_percent: parseFloat(document.getElementById('insurancePercent').value), cash_balance: parseFloat(document.getElementById('cashBalance').value) }; try { await createEntry(entryData); await updateDashboard(); alert('‚úÖ Entry saved to database!'); document.getElementById('dailyForm').reset(); document.getElementById('taxesPercent').value = 8.3; document.getElementById('royaltyPercent').value = 4.5; document.getElementById('rentPercent').value = 8.5; document.getElementById('adPercent').value = 4.0; document.getElementById('cogsPercent').value = 36.7; document.getElementById('laborPercent').value = 19.0; document.getElementById('rmPercent').value = 0.7; document.getElementById('utilitiesPercent').value = 2.2; document.getElementById('merchantPercent').value = 0.6; document.getElementById('suppliesPercent').value = 0.0; document.getElementById('insurancePercent').value = 0.5; document.getElementById('entryDate').valueAsDate = new Date(); } catch (error) { alert('‚ùå Error saving entry. Check console for details.'); } });
        async function initialize() { const settings = await fetchSettings(); applyTheme(settings.dark_mode === 'true'); document.getElementById('entryDate').valueAsDate = new Date(); await updateDashboard(); }
        initialize();
    </script>
</body>
</html>
